---
title: "TSR - Spatial statistics"
subtitle: "Spatial autocorrelation"
author: "Domenico Giusti"
bibliography: "../doc/manuscript/tsr_rr.bib"
output: html_document
fig_caption: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

Commonly applied circular statistics are global statistics. Till now, attempts to analyse local variation in the orientation of clasts/bones have followed a simplicistic selection of areas or subsets, mostly based on visual interpreations of the distribution.

We are interested in the spatial variation of fabrics within the study area.

> Spatial autocorrelation statistics measure and analyze the degree of dependency among observations in a geographic space. Classic spatial autocorrelation statistics include Moran's I {\displaystyle I} I, Geary's C {\displaystyle C} C, Getis's G {\displaystyle G} G. [...] These statistics require measuring a spatial weights matrix that reflects the intensity of the geographic relationship between observations in a neighborhood. [...] Classic spatial autocorrelation statistics compare the spatial weights to the covariance relationship at pairs of locations. Spatial autocorrelation that is more positive than expected from random indicate the clustering of similar values across geographic space, while significant negative spatial autocorrelation indicates that neighboring values are more dissimilar than expected by chance, suggesting a spatial pattern similar to a chess board. (https://en.wikipedia.org/wiki/Spatial_analysis#Spatial_autocorrelation)

## Reading and subsetting data

```{r, eval=TRUE, echo=FALSE, message=FALSE}
summary(d)
```

### Class intervals

```{r}
# classIntervals provides a uniform interface to finding class intervals for continuous numerical variables. [...] Class intervals are non-overlapping, and the classes are left-closed.
## http://cran.r-project.org/web/packages/classInt/classInt.pdf
library(classInt)
library(RColorBrewer)
pal <- brewer.pal(3, "Blues")
# fisher-jenks class distribution
fj8 <- classIntervals(fabric$bearing, n=8, style="fisher")
fj8
plot(fj8, pal=pal)
# rose quadrants class distribution
r8 <- classIntervals(fabric$bearing, n=8, style="fixed", fixedBreaks=breaks.8)
plot(r8, pal=pal)
```

```{r}
sp_fabric$bearing_class <- cut(sp_fabric$bearing,
                       breaks = c(360, 45, 90, 135, 180, 225, 270, 315, 360),
                       labels = c("0-45", "45-90", "90-135", "135-180", "180-225", "225-270", "270-315", "270-315", "315-360"),
                       right = TRUE)
```

## Global spatial autocorrelation

> Global spatial autocorrelation is a measure of the overall clustering of the data. One of the statistics used to evaluate global spatial autocorrelation is Moran's I (https://en.wikipedia.org/wiki/Indicators_of_spatial_association)

```{r}
# spdep method
library(spdep)

## Moran's I correlogram
###
coo <- coordinates(d)
id <- row.names(as(d, "data.frame"))
d.matrix <- spDists(d, d)
### Spatial neighbours
### Spatial weights
### Scatterplot & Correlogram
cor <- spdep::sp.correlogram(neighbours=kn3, var=d$value, order=2, method="I", style="C")
plot(cor)

## Geary's c correlogram
```

```{r}
# ncf method
library(ncf)

## Moran's I correlogram
ncf::plot.correlog(ncf::correlog(z=d$value, increment=2.8))
ncf::plot.correlog(ncf::correlog(x=spX$lon, y=spX$lat, z=spX$FTC, increment=2.8))
```

```{r}
# pgirmess method
library(pgirmess)

## Moran's I correlogram
cor <- pgirmess::correlog(coordinates(d), d[["value"]], method="Moran", nbclass=8)
print(cor)
plot(cor, main="FSHAPE"); abline(h=0, lty=2)
```


```{r}
library(pgirmess)
cor <- pgirmess::correlog(coordinates(sp_fabric), sp_fabric$bearing, method="Moran", nbclass=8)
print(cor)
plot(cor); abline(h=0, lty=2) #Moran
```

## Local spatial autocorrelation

> Global spatial analysis or global spatial autocorrelation analysis yields only one statistic to summarize the whole study area. In other words, global analysis assumes homogeneity. If that assumption does not hold, then having only one statistic does not make sense as the statistic should differ over space. But if there is no global autocorrelation or no clustering, we can still find clusters at a local level using local spatial autocorrelation. The fact that Moran's I is a summation of individual crossproducts is exploited by the "Local indicators of spatial association" (LISA) to evaluate the clustering in those individual units by calculating Local Moran's I for each spatial unit and evaluating the statistical significance for each Ii (https://en.wikipedia.org/wiki/Indicators_of_spatial_association)
